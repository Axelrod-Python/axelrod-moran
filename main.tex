\documentclass{article}

% Packages
\usepackage[margin=1.5cm, includefoot, footskip=30pt]{geometry}
\usepackage{hyperref}
\usepackage{multicol}
\usepackage{booktabs}
\usepackage{xstring}
\usepackage{subcaption}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{standalone}
\usepackage{fancyvrb}

\usepackage{tikz}
\usetikzlibrary{calc, shapes, patterns}

\usepackage[backend=biber, firstinits=false, backref=false, url=true,
            isbn=true, style=numeric]{biblatex}
\addbibresource{./tex/bibliography.bib}

% Title
\title{An Empirical Study of Invasion and Resistance for Iterated Prisoner's Dilemma Strategies}
\author{Marc Harper \and Vincent Knight \and Nikoleta E. Glynatsi} % TODO Authors?
\date{}


\begin{document}

\maketitle

\begin{abstract}
    The Iterated Prisoner's Dilemma is a well established framework for
    the study of emergent behaviour. In this paper an extensive numerical
    study of the evolutionary dynamics of this framework are presented. Fixation
    probabilities for Moran processes are obtained for 164
    different strategies. We find that players with long memories and
    sophisticated behaviours outperform many strategies that perform well
    in a two player setting.
\end{abstract}

\section{Introduction}\label{sec:introduction}

The Prisoner's Dilemma (PD)~\cite{Flood1958} is a fundamental two player game
used to model a large variety of strategic interactions. Each player can choose
between cooperation (C) or defection (D). The decisions are made simultaneously
and independently. The payoffs of
the game are defined by the matrix $\begin{pmatrix} R & S \\ T & P
\end{pmatrix}$, where $T > R > P > S$ and $2R > T + S$. The PD is a one
round game, but is commonly studied in a manner where the prior outcomes
matter. This extended form is called the Iterated Prisoner's
Dilemma (IPD).

The Moran Process \cite{Moran1957} is a model of
evolutionary population dynamics that has been used to gain insights about the
evolutionary stability and fixation of strategies in a number of settings.
Similarly since the first Iterated Prisoner's Dilemma (IPD) tournament described in
\cite{Axelrod1980a}, the Prisoner's dilemma has been used to understand the
evolution of cooperative behaviour in complex systems. Several earlier
works have studied iterated games in the context of the prisoner's dilemma
\cite{Nowak, Stewart2012}.

This manuscript provides a detailed numerical analysis of \textbf{164} complex
and adaptive strategies for the IPD\@. This is made possible by the Axelrod
library \cite{axelrodproject}, an effort to provide software for reproducible
research for the IPD\@. The library now contains over 150 parameterized
strategies including classics like TitForTat and WinStayLoseShift, as well as
recent variants such as OmegaTFT, zero determinant and other memory one
strategies, strategies based on finite state machines, lookup tables, neural
networks, and other machine learning based strategies, and a collection of novel
strategies. The library can conduct matches, tournaments and population
dynamics with variations including noise and spatial structure.

We present fixation probabilities for all pairs of
strategies in the library, identifying those are effective invaders and
those resistant to invasion, for population sizes $N=2$ to $N=14$.

In particular we address the following questions:
\begin{enumerate}
    \item What strategies are good invaders?
    \item What strategies are good at resisting invasion?
    \item How does the population size affect these findings?
\end{enumerate}


While our results agree with some of the published literature, we find that:

\begin{enumerate}
 \item Zero determinant strategies are not particularly effective for $N > 2$
 \item Long memory strategies are generally more effective than short
       memory strategies
 \item Complex strategies can be effective
\end{enumerate}


\subsection{The Moran Process}

Figure~\ref{fig:moran_process} shows a diagrammatic representation of the Moran
process, a stochastic birth death process on a finite population
in which the population size stays constant over time. Individuals are
\textbf{selected} according to a given fitness landscape. Once selected, the
individual is reproduced and similarly another individual is chosen to be
removed from the population. In some settings mutation is also considered but
without mutation (the case considered in this work) this process will arrive at
an absorbing state where the population is entirely made up of players of
one strategy. The probability with which a given strategy is the survivor is
called the fixation probability. A more detailed analytic description of this
is given in Section~\ref{sec:validation}.

\begin{figure}[!hbtp]
    \centering
    \input{./tex/moran_process.tex}
    \caption{A diagrammatic representation of a Moran process}
    \label{fig:moran_process}
\end{figure}

The Moran process was initially introduced in \cite{Moran1957}. It has since been
used in a variety of settings including the
understanding of the spread of cooperative and non-cooperative behaviour
such as cancer \cite{West2016} and the emergence of cooperative behaviour
in spatial topologies \cite{Nowak2017}. However these works
mainly consider non-sophisticated strategies. Some work has looked at
evolutionary stability of strategies within the Prisoner's Dilemma \cite{Li2014}
but this is not done in the more widely-used setting of the Moran process, rather in
terms of infinite population stability. In \cite{Baek2016} Moran processes are
studied in a theoretical framework for a small subset of strategies.
The subset included memory one strategies, strategies that recall the events
of the previous round only.

Of particular interest are the zero determinant strategies introduced in \cite{Press2012}
and highly-praised \cite{Stewart2012} it was argued that
generous ZD strategies are robust against invading strategies. However,
in \cite{Lee2015} a strategy using machine learning techniques was
capable of resisting invasion and also able to invade any memory one strategy.
Recent work \cite{Hilbe2017} has investigated the effect of memory length on
strategy performance and the emergence of cooperation but this is not done in
Moran process context and only considers specific cases of memory 2 strategies.
In \cite{Adami2013} it was recognized that many zero determinant strategies do
not fare well against themselves. This is a disadvantage for the Moran process
where the best strategies cooperate well with other players using the same strategy.

% TODO Add discussion about ZD strategies and discuss how this corresponds to
% case of N = 2. Include pointing at \cite{Adami2013} which discusses how ZD
% strategies are not fantastic in population dynamics.
% Add \cite{Li2014}

Section~\ref{sec:methodology} will explain the methodological approach used,
Section~\ref{sec:validation} will validate the methodology by comparing
simulated results to analytical results in some cases. The main results of this
manuscript are presented in Section~\ref{sec:empirical_results} which will
present a detailed analysis of all the data generated. Finally,
Section~\ref{sec:conclusion} will conclude and offer future avenues for the work
presented here.

\section{Methodology}\label{sec:methodology}

\subsection{The Axelrod Library}

The contribution of this work is a detailed and extensive analysis of absorption
probabilities for 164 strategies. These strategies and the numerical simulations
are from~\cite{axelrodproject} which is an open source research library written
for the study of the IPD\@. The strategies and simulation frameworks are
automatically tested to an extraordinarily high degree of coverage in accordance
with best research software practices. The large
number of strategies are available thanks to the open source nature of the
project with over 40 contributions made by different programmers and researchers.

To carry out this large numerical experiment, 164 strategies are used from
\cite{axelrodproject}. These include 161 default strategies in the library at
the time (excluding strategies classified as having a long run time and those
that make use of the length of the game) as well as
the following 3 finite state machine machine strategies \cite{Ashlock2006}:

% TODO Include details about the 3 extra FSM strategies.
% Possibly draw pictorial representations?
% Remove the FSM strategies if they don't perform well.

Appendix~\ref{app:list_of_players} shows all the players in question. More
information about each player can be obtained in the documentation for
\cite{axelrodproject}. There are \input{./tex/num_stochastic.tex}stochastic and
\input{./tex/num_deterministic.tex}deterministic strategies. Their memory
depth, defined by the number of rounds of history used by the strategy each round,
is shown in Table~\ref{tbl:memory_depth_count}. The memory depth is infinite if
the strategy uses the entire history of play (whatever its length). For example,
a strategy that utilizes a handshaking mechanism where the opponents actions
on the first few rounds of play determines the strategies subsequent behavior
would have infinite memory depth.

\begin{table}[!hbtp]
    \centering
        \input{./tex/memory_depth_count.tex}
        \caption{Memory depth}
        \label{tbl:memory_depth_count}
\end{table}

Each strategy pair is run for 1000 runs of the Moran process to fixation
with starting population distributions of $(1, N-1)$,
$(N/2, N/2)$ and $(N-1 , 1)$, for \(N\) from 2 through 14. The
% TODO Change 14 to 12 if we do not use the 14 case.
fixation probability is then empirically computed for each combination of
starting distribution and value of \(N\).

Our software can carry out exact simulations of the Moran process. Since some of
the strategies have a high computational cost or are stochastic, we sample
from a large number of match outcomes for the pairs of players for use in computing
fitnesses in the Moran process. This approach was verified to agree with unsampled
calculations to a high degree of accuracy in specific cases.
% TODO Perhaps write some pseudo code for this?

Figure~\ref{fig:number_of_stochastic_match_outcomes} shows the distribution of
the number of outcomes between all strategy pairs.
% TODO is this true? the distribution also matters, not just the number of outcomes
% TODO Good point, we could (if we wanted to) go down the line of checking
% specific distributions etc or perhaps we just remove and point at the good
% fits in the Validation section as a justification.


\begin{figure}[!hbtp]
    \centering
    \begin{subfigure}[t]{.5\textwidth}
        \centering
        \includegraphics[width=.9\textwidth]{./img/number_of_match_outcomes.pdf}
        \caption{All matches}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.5\textwidth}
        \centering
        \includegraphics[width=.9\textwidth]{./img/number_of_stochastic_match_outcomes.pdf}
        \caption{Stochastic matches}
    \end{subfigure}%
    \caption{The distribution of the number of unique outcomes used as the
    cached results}
    \label{fig:number_of_stochastic_match_outcomes}
\end{figure}

Section~\ref{sec:validation} will validate the methodology used here against
known theoretic results.

\section{Validation}\label{sec:validation}

As described in \cite{Nowak} consider the payoff matrix:

\begin{equation}\label{equ:payoff_matrix}
    M = \begin{pmatrix}
        a, b\\
        c, d
        \end{pmatrix}
\end{equation}

The expected payoffs of \(i\) players of the first type in a population with \(N
- i\) players of the second type are given by:

\begin{equation}\label{equ:expected_payoff_one}
    F_i = \frac{a(i - 1) + b(N - i)}{N - 1}
\end{equation}

\begin{equation}\label{equ:expected_payoff_two}
    G_i = \frac{ci + d(N - i - 1)}{N - 1}
\end{equation}

With an intensity of selection \(\omega\) the fitness of both strategies is
given by:

\begin{equation}\label{equ:expected_payoff_one}
    f_i = 1 - \omega + \omega F_i
\end{equation}

\begin{equation}\label{equ:expected_payoff_two}
    g_i = 1 - \omega + \omega G_i
\end{equation}

The transitions within the birth death process that underpins the Moran process
are then given by:

\begin{align}
	p_{i, i+1}&= \frac{if_i}{if_i+(N-i)g_i}\frac{N-i}{N}\label{equ:p_up}\\
	p_{i, i-1}&= \frac{(N-i)g_i}{if_i+(N-i)g_i}\frac{i}{N}\label{equ:p_down}\\
	p_{ii} &= 1 - p_{i, i+1} - p_{i, i-1}\label{equ:p_stay}
\end{align}

Using this it is a known result that the fixation probability of the first
strategy in a population of \(i\) individuals of the first type (and \(N-i\)
individuals of the second. We have:

\begin{equation}\label{equ:fixation_probability}
x_i = \frac{1 + \sum_{j=1}^{i-1}\prod_{k=1}^{j}\gamma_j}{1 + \sum_{j=1}^{N-1}
      \prod_{k=1}^{j}\gamma_j}
\end{equation}

where:

\[
\gamma_j = \frac{p_{j, j-1}}{p_{j, j+1}}
\]

A neutral strategy will have fixation probability $x_i = i/N$. Alternatively,
we can frame the outcomes in terms of relative fitness. For a strategy
of relative fitness $r$ the fixation probability is well-known to be

\[ x_i = \frac{1 - r^{-i}}{1 - r^{-N}} \]

We can use this formula to compute a value $r_i$ that produces the observed
value $x_i$, noting that for arbitrary strategies the value of this
effective relative fitness is dependent on $i$ and $N$.

Comparisons of \(x_1, x_{N/2}, x_{N-1}\) are shown in
Figure~\ref{fig:comparison_deterministic}. The points represent the simulated
values and the line shows the theoretical value. Note that these are all
deterministic strategies and show a perfect match up between the expected value
of (\ref{equ:fixation_probability}) and the actual Moran process for all
strategies pairs.

\begin{figure}[!hbtp]
    \centering
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Alternator_v_Cooperator.pdf}
        \caption{Alternator and Cooperator}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Alternator_v_Defector.pdf}
        \caption{Alternator and Defector}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Alternator_v_TfT.pdf}
        \caption{Alternator and Tit For Tat}
    \end{subfigure}%

    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Cooperator_v_TfT.pdf}
        \caption{Cooperator and Tit For Tat}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Defector_v_Cooperator.pdf}
        \caption{Defector and Cooperator}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Defector_v_TfT.pdf}
        \caption{Defector and Tit For Tat}
    \end{subfigure}%

    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/WSLS_v_TfT.pdf}
        \caption{Win Stay Lose Shift and Tit For Tat}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Alternator_v_WSLS.pdf}
        \caption{Alternator and Win Stay Lose Shift}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Defector_v_WSLS.pdf}
        \caption{Defector and Win Stay Lose Shift}
    \end{subfigure}%
    \caption{Comparison of theoretic and actual Moran Process fixation
             probabilities for \textbf{deterministic} strategies}
    \label{fig:comparison_deterministic}
\end{figure}

\begin{figure}[!hbtp]
    \centering
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Random_v_Cooperator.pdf}
        \caption{Random and Cooperator}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Random_v_Defector.pdf}
        \caption{Random and Defector}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Random_v_TfT.pdf}
        \caption{Random and Tit For Tat}
    \end{subfigure}%

    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/ALLCorALLD_v_Cooperator.pdf}
        \caption{All C or all D and Cooperator}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/ALLCorALLD_v_Defector.pdf}
        \caption{All C or all D and Defector}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Calculator_v_Random.pdf}
        \caption{Calculator and Random}
    \end{subfigure}%

    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Calculator_v_ALLCorALLD.pdf}
        \caption{Calculator and All C or all D}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Calculator_v_Arrogant_QLearner.pdf}
        \caption{Calculator and Arrogant Q learner}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/ALLCorALLD_v_TfT.pdf}
        \caption{All C or all D and Tit For Tat}
    \end{subfigure}%
    \caption{Comparison of theoretic and actual Moran Process
             fixation probabilities for \textbf{stochastic} strategies}
    \label{fig:comparison_stochastic}
\end{figure}

Figure~\ref{fig:comparison_stochastic} shows the fixation probabilities for
stochastic strategies. These are no longer a good match which highlights the
weakness of the analytical formulae that relies on the average payoffs. A
detailed analysis of the 164 strategies considered, using direct Moran processes
will be shown in the next Section.




\section{Empirical results}\label{sec:empirical_results}

% TODO Archive all data (Zenodo) and include details/reference here.

This section outlines the data analysis carried out:

\begin{itemize}
    \item Section~\ref{sec:two_individuals} considers the specific case of
        \(N=2\).
    \item Section~\ref{sec:strong_invaders} investigates the effect of
        population size on the ability of a strategy to invade another
        population. This will highlight how complex strategies with long
        memories outperform simpler strategies.
    \item Section~\ref{sec:strong_resistors} similarly investigates the
        ability to defend against an invasion.
    \item Section~\ref{sec:population_size} investigates the relationship
        between performance for differing population sizes.
    \item Section~\ref{sec:relative_fitness} calculates the relative fitness of all
        strategies.
\end{itemize}

\subsection{The special case of \(N=2\)}\label{sec:two_individuals}

When $N=2$ the Moran process is effectively a measure of the relative
mean payoffs over all possible matches between two players. The strategy
that scores higher than the other more often will fixate more often.

Overall the main fixation probabilities of interest are \(x_1\) and \(x_{N-1}\), these
reflect a strategy's ability to invade or resist invasion; for \(N=2\) these two cases
coincide. Figure~\ref{fig:fixation_heatmap_2} shows
all pairwise fixation probabilities for strategies on the vertical column when
being matched against probabilities on the horizontal column. This is summarised
in Figure~\ref{fig:boxplot_2} and Table~\ref{tbl:summary_top_2}.

\begin{enumerate}
    \item The top strategy is an extortionate Zero determinant
        strategy~\cite{Press2012} with parameters \(l=1\) and \(s=1/4\).
    \item The Collective strategy has a simple handshake mechanism (a
        cooperation followed by a defection on the first move). As long as the
        opponent plays the same handshake and does not defect in the future it
        cooperates. Otherwise it defects for all rounds~\cite{Li2009}.  This
        strategy was specifically designed for evolutionary processes.
    \item The finite state machine strategy % TODO Perhaps refer to earlier
        % discussion in the methodology section about these FSM strategies
    \item The Feld strategy is the corresponding strategy submitted to Axelrod's
        first tournament~\cite{Axelrod1980a}: it punishes defections but
        otherwise defects with a random probability that decays over time.
    \item The final strategy in the top five is another extortionate Zero
        determinant strategy~\cite{Press2012} with parameters \(l=p\).
\end{enumerate}


\begin{figure}[!hbtp]
    \begin{subfigure}[t]{.4\textwidth}
        \centering
        \includegraphics[width=\textwidth]{./img/fixation_heatmap_2_invade.pdf}
        % TODO Remove this: I don't feel it is effective.
        \caption{The pairwise fixation probabilities for \(N=2\)}
        \label{fig:fixation_heatmap_2}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.6\textwidth}
        \centering
        \includegraphics[height=.8\textheight]{./img/boxplot_2_invade.pdf}
        \caption{The median fixation probabilities for \(N=2\)}
        \label{fig:boxplot_2}
    \end{subfigure}
\end{figure}

\begin{table}[!hbtp]
    \centering
    \input{./tex/summary_top_2_invade.tex}
    \caption{Summary of top five strategies for \(N=2\)}
    \label{tbl:summary_top_2}
\end{table}

As will be demonstrated in Section~\ref{sec:population_size} the results for \(N=2\)
differ from those of larger $N$. Hence our results do not concur with the literature
which suggests that Zero Determinant strategies should be effective for larger population
sizes, but we note that those analysis run each match to stationarity, while
our matches run for a fixed number of rounds.

In the next sections we pay close attention to
strategies who are strong invaders/resistors and shown diagrammatically in
Figure~\ref{fig:invasion_resistance}.

\begin{figure}[!hbtp]
    \centering
    \input{./tex/invasion_resistance.tex}
    \caption{A single individual will successfully invade the population with
    probability \(x_1\). The group of Individuals will successfully resist with
    probability \(x_{N-1}\)}
    \label{fig:invasion_resistance}
\end{figure}

\subsection{Strong invaders}\label{sec:strong_invaders}

In this section we focus on the ability of a mutant strategy to invade: the
probability of 1 individual of a given type successfully becoming fixated in
a population of \(N - 1\) other individuals, denoted by \(x_i\).
Figures~\ref{fig:fixation_heatmap_invade} shows these values for
the players along the vertical axis when matched against the players on the
horizontal axis. For population size $N$, a neutral mutant has fixation
probability $x_1 = 1 / N$. This information is summarised in Figure~\ref{fig:fixation_boxplot_invade}
showing the median fixation as well as the neutral fixation for each given
scenario.

\begin{figure}[!hbtp]
    \centering
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/fixation_heatmap_3_invade.pdf}
        \caption{\(N=3\)}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/fixation_heatmap_7_invade.pdf}
        \caption{\(N=7\)}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/fixation_heatmap_12_invade.pdf}
        \caption{\(N=12\)}

    %TODO Replace N=12 with N=14
    \end{subfigure}%
    %TODO Remove these? I don't feel they are effective

    \caption{Pairwise fixation probability \(x_{1}\) of all strategies}
    \label{fig:fixation_heatmap_invade}
\end{figure}

\begin{figure}[!hbtp]
    \centering
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=\textwidth]{./img/boxplot_3_invade.pdf}
        \caption{\(N=3\)}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=\textwidth]{./img/boxplot_7_invade.pdf}
        \caption{\(N=7\)}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=\textwidth]{./img/boxplot_12_invade.pdf}
        \caption{\(N=12\)}
    \end{subfigure}%

    % TODO Replace N=12 with N=14 (when we have more data).
    \caption{Median probabilities \(x_{1}\) of all strategies as well as the
    neutral fixation probability}
    \label{fig:fixation_boxplot_invade}
\end{figure}

For \(N\in\{3, 7, 12\}\) the top five strategies are given in
% TODO Change N=12 to N=14
Tables~\ref{tbl:top_five_invade}.

\begin{table}[!hbtp]
    \begin{subfigure}[t]{\textwidth}
        \centering
        \input{./tex/summary_top_3_invade.tex}
        \caption{\(N=3\)}
    \end{subfigure}
    \begin{subfigure}[t]{\textwidth}
        \centering
        \input{./tex/summary_top_7_invade.tex}
        \caption{\(N=7\)}
    \end{subfigure}
    \begin{subfigure}[t]{\textwidth}
        \centering
        \input{./tex/summary_top_12_invade.tex}
        \caption{\(N=12\)}
    \end{subfigure}
    %TODO Change N=12 to N=14
    \caption{Properties of top five invaders}
    \label{tbl:top_five_invade}
\end{table}

It can be seen that apart from the Collective Strategy, none of the strategies
of Table~\ref{tbl:summary_top_2} perform well for \(N\in\{3, 7, 12\}\). The new
% TODO Change N=12 to N=14
high performing strategies are:

\begin{itemize}
    \item Predator, a finite state machine described in~\cite{Ashlock2006}.
    \item Prober 4, complex strategy with an initial 20 move sequence of
        cooperations and defections~\cite{prison}. This initial sequence serves
        as approximate handshake.
    \item Remorseful Prober, a strategy that will not immediately retaliate when
        it recognises that the opponent is retaliating to a random
        defection~\cite{Li2011}.
    \item  Worse and Worse 2: plays Tit For Tat for 20 moves and then defects
        with with growing probability~\cite{prison}.
    \item Tester: a strategy submitted to the second of Axelrod's tournaments
        \cite{Axelrod1980b}.
        % TODO Check if this list is still correct for N=14
\end{itemize}

As well as noting that the memory length and complexity of these strategies are
much greater than one, it is interesting to note that none of them are akin to
memory one strategies. Most are not stochastic.

\subsection{Strong resistors}\label{sec:strong_resistors}

In addition to identifying good invaders, we also identify strategies
resistant to invasion by other strategies by examining the distribution
of $x_{N-1}$ for each strategy. Note that this is equivalent to
looking at $x_1$ for all opponents.

Figures~\ref{fig:fixation_heatmap_resist} show \(x_{N-1}\)
the players along the vertical axis when matched against the players on the
horizontal axis. This information is summarised in Figure~\ref{fig:fixation_boxplot_resist}
showing the median fixation as well as the neutral fixation for each given
scenario.

\begin{figure}[!hbtp]
    \centering
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/fixation_heatmap_3_resist.pdf}
        \caption{\(N=3\)}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/fixation_heatmap_7_resist.pdf}
        \caption{\(N=7\)}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/fixation_heatmap_12_resist.pdf}
        \caption{\(N=12\)}

    %TODO Replace N=12 with N=14
    \end{subfigure}%
    %TODO Remove these? I don't feel they are effective

    \caption{Pairwise fixation probability \(x_{N-1}\) of all strategies}
    \label{fig:fixation_heatmap_resist}
\end{figure}

\begin{figure}[!hbtp]
    \centering
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=\textwidth]{./img/boxplot_3_resist.pdf}
        \caption{\(N=2\)}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=\textwidth]{./img/boxplot_7_resist.pdf}
        \caption{\(N=7\)}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=\textwidth]{./img/boxplot_12_resist.pdf}
        \caption{\(N=12\)}
    \end{subfigure}%

    % TODO Replace N=12 with N=14 (when we have more data).
    \caption{Median probabilities \(x_{N-1}\) of all strategies as well as the
    neutral fixation probability}
    \label{fig:fixation_boxplot_resist}
\end{figure}

Table~\ref{tbl:top_five_resist} shows the top five strategies when ranked
according to \(x_{N-1}\) for \(N\in\{3, 7, 12\}\).
% TODO Change 12 to 14
Once again none of the short memory strategies from
Section~\ref{sec:two_individuals} perform well for high \(N\).

Three strategies have both high \(x_1\) and high \(x_{N-1}\):

\begin{itemize}
    \item Collective
    \item Predator
    \item Prober 4
\end{itemize}

However, Remorseful Prober, Worse and Worse 2 and Tester no longer do as well.
There are two strategies that are only top performers in \(x_{N-1}\):

\begin{itemize}
    \item Handshake: a slightly less aggressive version of the Collective
        strategy \cite{robson1989}. As long as the initial sequence is played
        then it cooperates. Thus it will do well in a population consisting of
        many members of itself: just as the Collective strategy does. However it
        is not aggressive enough to invade other populations.
    \item Winner 21: a strategy that makes its decision deterministically based
        on 1 round of its own strategy and 2 of the opponent's strategy
        \cite{Mathieu2015}.
\end{itemize}
% TODO Revise this if need be for N=14

Interestingly none of these strategies are stochastic: this is explained by
the need of strategies to have a steady hand when interacting with their own
kind. In essence: acting stochastically increase the chance of friendly fire.
However we note that it is possible to design a strategy with a ``stochastic
handshake'' \cite{Lee2015}.


\begin{table}[!hbtp]
    \begin{subfigure}[t]{\textwidth}
        \centering
        \input{./tex/summary_top_3_resist.tex}
        \caption{\(N=3\)}
    \end{subfigure}
    \begin{subfigure}[t]{\textwidth}
        \centering
        \input{./tex/summary_top_7_resist.tex}
        \caption{\(N=7\)}
    \end{subfigure}
    \begin{subfigure}[t]{\textwidth}
        \centering
        \input{./tex/summary_top_12_resist.tex}
        \caption{\(N=12\)}
    \end{subfigure}
    %TODO Change N=12 to N=14
    \caption{Properties of top five resistors}
    \label{tbl:top_five_resist}
\end{table}

It is evident through
Sections~\ref{sec:two_individuals},~\ref{sec:strong_invaders}
and~\ref{sec:strong_resistors} that performance of strategies not only depends
on the initial population distribution but also that there seems to be a
difference depending on whether or not \(N>2\). This will be explored further in
the next section.

\subsection{The effect of population size}\label{sec:population_size}

Figures~\ref{fig:ranks_v_size_invade},~\ref{fig:ranks_v_size_resist}
and~\ref{fig:ranks_v_size_coexist} show the median rank of each strategy against
population size. For all starting populations \(i\in\{1, N/2, N-1\}\) the ranks
of strategies are relatively stable across the different values of \(N>2\)
however for \(N=2\) there is a distinct difference. This confirms what has been
discussed in previous sections.

Tables~\ref{tbl:ranks_v_size_invade},~\ref{tbl:ranks_v_size_resist}
and~\ref{tbl:ranks_v_size_coexist} show the same information for the strategies
that rated high for \(N=2\) and \(N=12\).
% TODO Change to N=14?

\begin{figure}[!hbtp]
    \centering
    \includegraphics[height=.9\textheight]{./img/median_rank_vs_population_size_invade.pdf}
    \caption{Ranks of all strategies according to \(x_1\) for different
    population sizes}
    \label{fig:ranks_v_size_invade}
\end{figure}

\begin{table}[!hbtp]
    \centering
    \scriptsize
    \input{./tex/change_of_rank_invade.tex}
    \caption{Ranks of some strategies according to \(x_1\) for different
    population sizes}
    \label{tbl:ranks_v_size_invade}
\end{table}

\begin{figure}[!hbtp]
    \centering
    \includegraphics[height=.9\textheight]{./img/median_rank_vs_population_size_resist.pdf}
    \caption{Ranks of all strategies according to \(x_{N-1}\) for different
    population sizes}
    \label{fig:ranks_v_size_resist}
\end{figure}

\begin{table}[!hbtp]
    \centering
    \scriptsize
    \input{./tex/change_of_rank_resist.tex}
    \caption{Ranks of some strategies according to \(x_{N-1}\) for different
    population sizes}
    \label{tbl:ranks_v_size_resist}
\end{table}

\begin{figure}[!hbtp]
    \centering
    \includegraphics[height=.9\textheight]{./img/median_rank_vs_population_size_coexist.pdf}
    \caption{Ranks of all strategies according to \(x_{N/2}\) for different
    population sizes}
    \label{fig:ranks_v_size_coexist}
\end{figure}

\begin{table}[!hbtp]
    \centering
    \scriptsize
    \input{./tex/change_of_rank_coexist.tex}
    \caption{Ranks of some strategies according to \(x_{N/2}\) for different
    population sizes}
    \label{tbl:ranks_v_size_coexist}
\end{table}

Tables~\ref{tbl:correlation_coeficients_invade},~\ref{tbl:correlation_coeficients_resist}
and~\ref{tbl:correlation_coeficients_coexist} show the correlation coefficients
of the ranks in of strategies in differing population size. This is shown
graphically in Figure~\ref{fig:correlation_coefficients}. It is immediate to
note that how well a strategy performs in any Moran process for \(N>2\) has
little to do with the performance for \(N=2\). This illustrates why the strong
performance of zero determinant strategies predicted in \cite{Press2012} does
not extend to larger populations. This was discussed theoretically in
\cite{Adami2013} however not observed empirically at the scale presented here.


\begin{table}[!hbtp]
    \centering
    \begin{subfigure}{\textwidth}
        \centering
        \input{"./tex/correlation_coeficients_invade.tex"}
        \caption{Correlation coefficients for ranks for invasion}
        \label{tbl:correlation_coeficients_invade}
    \end{subfigure}%

    \begin{subfigure}{\textwidth}
        \centering
        \input{"./tex/correlation_coeficients_resist.tex"}
        \caption{Correlation coefficients for ranks for resistance}
        \label{tbl:correlation_coeficients_resist}
    \end{subfigure}

    \begin{subfigure}{\textwidth}
        \centering
        \input{"./tex/correlation_coeficients_coexist.tex"}
        \caption{Correlation coefficients for ranks for coexistance}
        \label{tbl:correlation_coeficients_coexist}
    \end{subfigure}
    \caption{Correlation coefficients of rankings by population size}
\end{table}

\begin{figure}[!htbp]
	\centering
	\begin{subfigure}[t]{.3\textwidth}
		\centering
		\includegraphics[width=.9\textwidth]{./img/correlation_heatmap_invade.pdf}
		\caption{Rank based on \(x_1\)}
    \end{subfigure}
    ~
	\begin{subfigure}[t]{.3\textwidth}
		\centering
		\includegraphics[width=.9\textwidth]{./img/correlation_heatmap_resist.pdf}
        \caption{Rank based on \(x_{N - 1}\)}
    \end{subfigure}
    ~
	\begin{subfigure}[t]{.3\textwidth}
		\centering
		\includegraphics[width=.9\textwidth]{./img/correlation_heatmap_coexist.pdf}
        \caption{Rank based on \(x_{N/2}\)}
    \end{subfigure}
    \caption{Heatmap of correlation coefficients of rankings by population size}
    \label{fig:correlation_coefficients}
\end{figure}

\subsection{Relative fitness}\label{sec:relative_fitness}

% TODO I do not understand the narrative for this and what it adds to the paper.

Under the assumption of a constant relative fitness \(r\) between two
strategies~\cite{Nowak} the formula for \(x_i\) (for given \(N, r\) is:

\begin{equation}\label{equ:fixation_probability_with_constant_relative_fitness}
    x_i = x_i(r) = \frac{1-\frac{1}{r^{i}}}{1-\frac{1}{r^{N}}}
\end{equation}

Figure~\ref{fig:fixation_v_fitness_illustration} shows this function for
\(N=10\) and \(i\in\{1, 5, 10\}\).

\begin{figure}[!hbtp]
    \centering
    \includegraphics[width=.6\textwidth]{./img/fixation_v_fitness_illustration.pdf}
    \caption{\(x_i(r)\)}
    \label{fig:fixation_v_fitness_illustration}
\end{figure}

The first and second derivative of
(\ref{equ:fixation_probability_with_constant_relative_fitness}) is given by equations
(\ref{equ:fixation_probability_with_constant_relative_fitness_prime}) and
(\ref{equ:fixation_probability_with_constant_relative_fitness_prime2}).

\begin{equation}\label{equ:fixation_probability_with_constant_relative_fitness_prime}
    \frac{dx_i}{dr} = \input{./tex/fixation_probability_with_constant_relative_fitness_prime.tex}
\end{equation}

\begin{equation}\label{equ:fixation_probability_with_constant_relative_fitness_prime2}
    \frac{d^2x_i}{dr^2} = \input{./tex/fixation_probability_with_constant_relative_fitness_prime2.tex}
\end{equation}

Using these, Halley's method \cite{Alefeld2012} can be used to efficiently
numerically invert \(x_i(r)\) to obtain a theoretic relative fitness \(r\) that
gives the calculated \(x_i(r)\) between two strategies for a given \(N, i\).
% TODO Say more things: I still think this is a bit cylic. The formula we are
% using assumes a constant relative fitness which we know does not exist.

\begin{figure}[!hbtp]
    \centering
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Alternator_v_Cooperator_fitness.pdf}
        \caption{Alternator and Cooperator}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Alternator_v_Defector_fitness.pdf}
        \caption{Alternator and Defector}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Alternator_v_Tit_For_Tat_fitness.pdf}
        \caption{Alternator and Tit For Tat}
    \end{subfigure}%

    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Cooperator_v_Tit_For_Tat_fitness.pdf}
        \caption{Cooperator and Tit For Tat}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Defector_v_Cooperator_fitness.pdf}
        \caption{Defector and Cooperator}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Defector_v_Tit_For_Tat_fitness.pdf}
        \caption{Defector and Tit For Tat}
    \end{subfigure}%

    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Win-Stay_Lose-Shift_v_Tit_For_Tat_fitness.pdf}
        \caption{Win Stay Lose Shift and Tit For Tat}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Alternator_v_Win-Stay_Lose-Shift_fitness.pdf}
        \caption{Alternator and Win Stay Lose Shift}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Defector_v_Win-Stay_Lose-Shift_fitness.pdf}
        \caption{Defector and Win Stay Lose Shift}
    \end{subfigure}%
    \caption{Estimated relative fitness
             for \textbf{deterministic} strategies}
    \label{fig:comparison_deterministic}
\end{figure}

\begin{figure}[!hbtp]
    \centering
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Random_v_Cooperator_fitness.pdf}
        \caption{Random and Cooperator}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Random_v_Defector_fitness.pdf}
        \caption{Random and Defector}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Random_v_Tit_For_Tat_fitness.pdf}
        \caption{Random and Tit For Tat}
    \end{subfigure}%

    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/ALLCorALLD_v_Cooperator_fitness.pdf}
        \caption{All C or all D and Cooperator}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/ALLCorALLD_v_Defector_fitness.pdf}
        \caption{All C or all D and Defector}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Calculator_v_Random_fitness.pdf}
        \caption{Calculator and Random}
    \end{subfigure}%

    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Calculator_v_ALLCorALLD_fitness.pdf}
        \caption{Calculator and All C or all D}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/Calculator_v_Arrogant_QLearner_fitness.pdf}
        \caption{Calculator and Arrogant Q learner}
    \end{subfigure}%
    ~
    \begin{subfigure}[t]{.3\textwidth}
        \centering
        \includegraphics[width=.8\textwidth]{./img/ALLCorALLD_v_Tit_For_Tat_fitness.pdf}
        \caption{All C or all D and Tit For Tat}
    \end{subfigure}%
    \caption{Estimated relative fitness
             for \textbf{stochastic} strategies}
    \label{fig:comparison_stochastic}
\end{figure}


\section{Conclusion}\label{sec:conclusion}

A detailed empirical analysis of 164 strategies of the IPD within a pairwise
Moran process has been carried out. All \(\binom{164}{2}=13,366\) possible
ordered pairs of strategies have been placed in a Moran process with different
starting values allowing the each strategy to attempt to invade the other.

This is the largest such experiment carried out and has lead to many insights.

When studying evolutionary processes it is vital to consider \(N>2\) as the
special case for \(N=2\) cannot be used to extrapolate performance in bigger
populations. This was shown both observationally in
Sections~\ref{sec:strong_invaders} and~\ref{sec:strong_resistors} but also by
considering the correlation of the ranks in different population sizes in
Section~\ref{sec:population_size}.

For \(N=2\), memory one strategies perform well, in particular as predicted by
\cite{Press2012} zero determinant strategies rank highly. However, there are no
memory one strategies in the top 5 performing strategies for \(N>3\). This is
due to their lack of sophistication which allows them to recognise and adjust to
their opponent.

It is felt that these findings are important for the ongoing understanding of
population dynamics and offer evidence for some of the shortcomings of short
memory which has started to be recognised by the community~\cite{Hilbe2017}.

All source code for this work has been written in a sustainable manner: it is
open source, under version control and tested which ensures that all results can
be reproduced \cite{Prlic2012, Sandve2013, Wilson2014}. The raw data as well as
the processed data has also been properly archived.

There are various areas for further work to build on this. Firstly, an analysis
of the effect of noise would offer insights about the stability of the findings.
It would also be possible to consider three or more types of strategy in the
population and finally mutation would also offer an interesting dimension to
explore.

\section*{Acknowledgements}

This work was performed using the computational facilities of the Advanced
Research Computing @ Cardiff (ARCCA) Division, Cardiff University.

A variety of software libraries have been used in this work:

\begin{itemize}
    \item The Axelrod library (IPD strategies and Moran processes)
        \cite{axelrodproject}.
    \item The matplotlib library (visualisation) \cite{hunter2007matplotlib}.
    \item The pandas and numpy libraries (data manipulation)
        \cite{mckinney2010data, walt2011numpy}.
\end{itemize}

\printbibliography

\appendix

\section{List of players}\label{app:list_of_players}

\begin{multicols}{3}
	\begin{enumerate}
		\input{./tex/list_of_players.tex}
	\end{enumerate}
\end{multicols}

\end{document}
